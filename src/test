Summary

This PR refactors the authorizeRequest logic to clearly separate legacy auth routes, role-based routes (advisor / traveler), and protected content, and fixes an issue that caused infinite redirect loops (ERR_TOO_MANY_REDIRECTS) when unauthenticated users accessed certain pages.

Problem

Legacy routes like /login, /register, and /forgot-password were treated as normal unprotected pages.

This caused unauthenticated requests to be redirected repeatedly between legacy routes and role-specific login routes (e.g. /login → /advisor/login → /login).

In some cases, authorization was also being applied to paths that don’t exist (e.g. /dashboard), resulting in unexpected behavior or 404s.

Solution

Explicitly classified legacy auth routes as entry points that always redirect to the appropriate role-specific routes (defaulting to Travel Advisor for now).

Ensured role auth routes (/advisor/login, /advisor/register, etc.) are truly unprotected for unauthenticated users to prevent redirect loops.

Simplified authorization flow by:

Handling legacy routes first

Then unauthenticated access

Then role-based protection (advisor vs traveler)

Added/updated tests to reflect the new behavior and prevent regressions.

Result

Eliminates infinite redirect loops

Makes authorization behavior predictable and easier to reason about

Prepares the codebase for future removal of legacy auth routes and proper Auth0 role enforcement
